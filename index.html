<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1020" />
  <title>Para Ale ðŸ’›</title>

  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#1a0f2e;
      --glass: rgba(255,255,255,.10);
      --glass2: rgba(255,255,255,.14);
      --shadow: 0 18px 50px rgba(0,0,0,.45);

      --rose1:#ff4d6d;
      --rose2:#ff7ac8;
      --gold:#ffd36a;
      --stem1:#2ee59d;
      --stem2:#167a55;
      --leaf1:#7dffb1;
      --leaf2:#27b874;

      --paper:#fff7ea;
      --ink:#2a2233;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:#fff;
      background:
        radial-gradient(1200px 800px at 20% 10%, #2d1650 0%, transparent 60%),
        radial-gradient(900px 700px at 80% 20%, #1a3a6b 0%, transparent 55%),
        radial-gradient(900px 800px at 60% 90%, #3c1a2a 0%, transparent 55%),
        linear-gradient(160deg,var(--bg1),var(--bg2));
      overflow:hidden;
      -webkit-tap-highlight-color: transparent;
    }

    .stage{
      height:100%;
      width:100%;
      display:grid;
      place-items:center;
      padding: 24px 16px max(24px, env(safe-area-inset-bottom));
      position:relative;
    }

    /* Fondo con estrellitas */
    .sparkles{
      position:absolute; inset:0;
      background:
        radial-gradient(2px 2px at 15% 25%, rgba(255,255,255,.7), transparent 60%),
        radial-gradient(2px 2px at 35% 65%, rgba(255,255,255,.5), transparent 60%),
        radial-gradient(2px 2px at 75% 35%, rgba(255,255,255,.6), transparent 60%),
        radial-gradient(2px 2px at 85% 75%, rgba(255,255,255,.5), transparent 60%),
        radial-gradient(2px 2px at 55% 20%, rgba(255,255,255,.45), transparent 60%),
        radial-gradient(2px 2px at 10% 80%, rgba(255,255,255,.45), transparent 60%);
      opacity:.55;
      animation: twinkle 3.5s ease-in-out infinite alternate;
      pointer-events:none;
    }
    @keyframes twinkle{
      from{filter:blur(.2px); transform:scale(1)}
      to{filter:blur(0px); transform:scale(1.02)}
    }

    .screen{
      width:min(520px, 92vw);
      display:grid;
      justify-items:center;
      gap:16px;
    }

    /* ---------- INTRO ---------- */
    .screen--intro{
      min-height: 82vh;
      align-content:center;
      padding-top: 10vh; /* baja un poco el corazÃ³n */
    }

    .heartButton{
      border:0;
      background:transparent;
      cursor:pointer;
      display:grid;
      place-items:center;
      gap:14px;
      padding:18px 14px;
      border-radius:22px;
      outline:none;
      user-select:none;
      touch-action: manipulation;
    }

    .heart{
      width:180px;
      height:180px;
      position:relative;
      transform: rotate(-45deg);
      background: linear-gradient(135deg, var(--rose1), var(--rose2));
      border-radius: 24px;
      box-shadow: 0 20px 65px rgba(255, 121, 198, .35);
      animation: heartbeat 1.15s ease-in-out infinite;
    }
    .heart::before,
    .heart::after{
      content:"";
      position:absolute;
      width:180px;
      height:180px;
      background: inherit;
      border-radius: 50%;
    }
    .heart::before{ top:-90px; left:0; }
    .heart::after{ left:90px; top:0; }

    @keyframes heartbeat{
      0%,100%{ transform:rotate(-45deg) scale(1); }
      40%{ transform:rotate(-45deg) scale(1.07); }
      60%{ transform:rotate(-45deg) scale(1.03); }
    }

    .heartText{
      text-align:center;
      font-size: clamp(16px, 3.8vw, 20px);
      line-height:1.2;
      opacity:.95;
      text-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .hint{
      margin:0;
      font-size:14px;
      opacity:.82;
    }

    /* TransiciÃ³n intro -> flores */
    .fadeOut{
      animation: fadeOut .35s ease forwards;
    }
    @keyframes fadeOut{
      to{ opacity:0; transform: translateY(10px); }
    }
    .fadeIn{
      animation: fadeIn .35s ease forwards;
    }
    @keyframes fadeIn{
      from{opacity:0; transform: translateY(10px);}
      to{opacity:1; transform: translateY(0);}
    }

    /* ---------- FLORES ---------- */
    .topMessage{
      padding:12px 16px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      text-align:center;
      font-size: clamp(15px, 3.7vw, 18px);
      transform: translateY(-8px);
      opacity:0;
    }

    .bouquet{
      width:min(430px, 92vw);
      height: 450px;
      border:0;
      background: transparent;
      cursor:pointer;
      position:relative;
      border-radius:28px;
      display:block;
      outline:none;
      user-select:none;
      touch-action: manipulation;
    }

    .tapBadge{
      position:absolute;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      padding:8px 12px;
      border-radius:999px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.14);
      font-size:14px;
      opacity:.9;
    }

    /* Tallos (crecen) */
    .stem{
      position:absolute;
      bottom:70px;
      width:10px;
      height: 0px; /* animaciÃ³n */
      background: linear-gradient(var(--stem1), var(--stem2));
      border-radius:10px;
      transform-origin: bottom;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.25));
    }

    /* posiciones: 3 tallos */
    .stem.s1{ left:36%; transform: rotate(-8deg); }
    .stem.s2{ left:52%; transform: rotate(2deg); }
    .stem.s3{ left:68%; transform: rotate(10deg); }

    /* Hojas (aparecen) */
    .leaf{
      position:absolute;
      width: 0px; height: 0px;
      background: radial-gradient(circle at 30% 30%, var(--leaf1), var(--leaf2));
      border-radius: 60% 40% 60% 40%;
      opacity:0;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.22));
    }
    .leaf.l1{ left:31%; bottom:170px; transform: rotate(-18deg); }
    .leaf.l2{ left:50%; bottom:205px; transform: rotate(18deg); }
    .leaf.l3{ left:66%; bottom:160px; transform: rotate(28deg); }

    /* Rosas */
    .rose{
      position:absolute;
      width: 0px; height: 0px; /* animaciÃ³n bloom */
      opacity:0;
      transform: translateY(14px) scale(.78);
      filter: drop-shadow(0 14px 22px rgba(0,0,0,.30));
      border-radius: 50%;
    }

    /* UbicaciÃ³n de cada rosa sobre su tallo */
    .rose.r1{ left:30%; bottom:255px; }
    .rose.r2{ left:46%; bottom:292px; }
    .rose.r3{ left:62%; bottom:250px; }

    /* Cabeza de rosa: usa "capas" para parecer pÃ©talos en espiral */
    .rose .petal{
      position:absolute;
      inset:0;
      border-radius:50%;
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.85), transparent 55%),
        radial-gradient(circle at 65% 70%, rgba(0,0,0,.12), transparent 52%),
        linear-gradient(135deg, var(--rose2), var(--rose1));
      transform: rotate(var(--rot,0deg)) scale(var(--sc,1));
      clip-path: polygon(50% 0%, 64% 10%, 78% 24%, 90% 40%, 96% 58%, 88% 74%, 72% 86%, 50% 94%, 28% 86%, 12% 74%, 4% 58%, 10% 40%, 22% 24%, 36% 10%);
      opacity: var(--op,1);
    }
    .rose .core{
      position:absolute;
      left:50%; top:50%;
      width: 0px; height:0px; /* animaciÃ³n */
      transform: translate(-50%,-50%) rotate(12deg);
      border-radius: 50%;
      background:
        radial-gradient(circle at 35% 35%, #fff, var(--gold) 55%, #d18a00);
      box-shadow: 0 10px 24px rgba(255,211,106,.35);
    }

    /* Mensaje inferior */
    .bottomNote{
      font-size:12px;
      opacity:.65;
      text-align:center;
      max-width: 44ch;
    }

    /* ---------- CARTA / OVERLAY ---------- */
    .overlay{
      position:fixed; inset:0;
      display:none;            /* apagado por defecto */
      place-items:center;
      padding: 18px 14px max(18px, env(safe-area-inset-bottom));
    }
    .overlay.active{
      display:grid;            /* encendido */
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(9px);
      -webkit-backdrop-filter: blur(9px);
    }

    .card{
      width:min(540px, 94vw);
      background: linear-gradient(180deg, #fffdf7, var(--paper));
      color: var(--ink);
      border-radius: 22px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      transform: translateY(10px) scale(.98);
      opacity:0;
    }

    .overlay.showCard .card{
      animation: cardIn .32s ease forwards;
    }
    @keyframes cardIn{
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .card::before{
      content:"";
      position:absolute; inset:-120px -120px auto -120px;
      height:220px;
      background:
        radial-gradient(circle at 30% 40%, rgba(255,121,198,.35), transparent 60%),
        radial-gradient(circle at 70% 30%, rgba(255,211,106,.35), transparent 60%);
      transform: rotate(8deg);
    }

    .cardHeader{
      padding:22px 18px 8px;
      text-align:center;
      position:relative;
    }
    .stamp{
      width:46px; height:46px;
      display:grid; place-items:center;
      margin:0 auto 8px;
      border-radius:14px;
      background: rgba(255,121,198,.18);
      border: 1px solid rgba(255,121,198,.25);
      user-select:none;
    }
    .cardHeader h1{
      margin:0;
      font-size:26px;
      letter-spacing:.2px;
    }
    .cardHeader p{
      margin:6px 0 0;
      opacity:.7;
    }

    .cardBody{
      padding: 10px 20px 18px;
      line-height:1.6;
      font-size:16px;
      position:relative;
    }
    .cardBody p{ margin: 10px 0; }
    .signature{
      margin-top:14px;
      text-align:right;
    }
    .signature .line{ font-size:18px; }

    .cardFooter{
      padding: 12px 18px 16px;
      text-align:center;
      opacity:.7;
      font-size:12px;
    }

    .close{
      position:absolute;
      right:10px;
      top:10px;
      border:0;
      background: rgba(0,0,0,.08);
      color:#2a2233;
      width:38px; height:38px;
      border-radius:12px;
      cursor:pointer;
      touch-action: manipulation;
    }

    /* ---------- CONSTRUCCIÃ“N (clase build) ---------- */
    .build .topMessage{
      animation: fadeDown .7s ease forwards;
    }
    @keyframes fadeDown{
      from{opacity:0; transform: translateY(-12px)}
      to{opacity:1; transform: translateY(-8px)}
    }

    .build .stem{ animation: growStem .95s cubic-bezier(.2,.9,.2,1) forwards; }
    .build .stem.s1{ animation-delay: .05s }
    .build .stem.s2{ animation-delay: .12s }
    .build .stem.s3{ animation-delay: .20s }
    @keyframes growStem{
      from{ height:0px }
      to{ height: 230px }
    }

    .build .leaf{
      animation: popLeaf .6s ease forwards;
    }
    .build .leaf.l1{ animation-delay:.40s }
    .build .leaf.l2{ animation-delay:.52s }
    .build .leaf.l3{ animation-delay:.64s }
    @keyframes popLeaf{
      from{ width:0; height:0; opacity:0; transform: translateY(10px) rotate(0deg); }
      to{ width:82px; height:46px; opacity:1; transform: translateY(0) rotate(0deg); }
    }

    /* Bloom de rosas */
    .build .rose{
      animation: bloom .85s cubic-bezier(.2,.9,.2,1) forwards;
    }
    .build .rose.r1{ animation-delay:.70s }
    .build .rose.r2{ animation-delay:.86s }
    .build .rose.r3{ animation-delay:1.02s }

    @keyframes bloom{
      from{ width:0; height:0; opacity:0; transform: translateY(16px) scale(.72); }
      to{ width:128px; height:128px; opacity:1; transform: translateY(0) scale(1); }
    }

    .build .rose .core{
      animation: corePop .55s ease forwards;
      animation-delay: 1.20s;
    }
    @keyframes corePop{
      from{ width:0; height:0; }
      to{ width:32px; height:32px; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .heart{ animation:none }
      .sparkles{ animation:none }
      .build .stem, .build .leaf, .build .rose, .build .topMessage{
        animation:none !important;
        opacity:1 !important;
        transform:none !important;
      }
      .stem{ height:230px }
      .leaf{ width:82px; height:46px; opacity:1 }
      .rose{ width:128px; height:128px; opacity:1 }
      .rose .core{ width:32px; height:32px }
      .overlay.showCard .card{ animation:none !important; opacity:1; transform:none; }
    }
  </style>
</head>

<body>
  <main class="stage">
    <div class="sparkles" aria-hidden="true"></div>

    <!-- INTRO -->
    <section class="screen screen--intro" id="intro">
      <button class="heartButton" id="heartBtn" aria-label="Toca el corazÃ³n para la sorpresa">
        <span class="heart" aria-hidden="true"></span>
        <span class="heartText">Toca el corazÃ³n<br><b>para la sorpresa</b></span>
      </button>
      <p class="hint">Hecho con cariÃ±o para Ale âœ¨</p>
    </section>

    <!-- FLORES -->
    <section class="screen screen--flowers fadeIn" id="flowersScreen" hidden>
      <div class="topMessage" id="topMessage" aria-live="polite">
        Ale, gracias por tu amistad ðŸ’›
      </div>

      <button class="bouquet" id="bouquetBtn" aria-label="Toca las rosas para abrir la carta">
        <!-- Tallos -->
        <div class="stem s1"></div>
        <div class="stem s2"></div>
        <div class="stem s3"></div>

        <!-- Hojas -->
        <div class="leaf l1"></div>
        <div class="leaf l2"></div>
        <div class="leaf l3"></div>

        <!-- Rosas -->
        <div class="rose r1" aria-hidden="true">
          <span class="petal" style="--rot: 0deg;  --sc: 1.00; --op:.98"></span>
          <span class="petal" style="--rot: 30deg; --sc: .96; --op:.96"></span>
          <span class="petal" style="--rot: 60deg; --sc: .92; --op:.94"></span>
          <span class="petal" style="--rot: 90deg; --sc: .88; --op:.92"></span>
          <span class="petal" style="--rot: 120deg;--sc: .84; --op:.90"></span>
          <span class="core"></span>
        </div>

        <div class="rose r2" aria-hidden="true">
          <span class="petal" style="--rot: 10deg; --sc: 1.00; --op:.98"></span>
          <span class="petal" style="--rot: 40deg; --sc: .96; --op:.96"></span>
          <span class="petal" style="--rot: 70deg; --sc: .92; --op:.94"></span>
          <span class="petal" style="--rot: 100deg;--sc: .88; --op:.92"></span>
          <span class="petal" style="--rot: 130deg;--sc: .84; --op:.90"></span>
          <span class="core"></span>
        </div>

        <div class="rose r3" aria-hidden="true">
          <span class="petal" style="--rot: 0deg;  --sc: 1.00; --op:.98"></span>
          <span class="petal" style="--rot: 28deg; --sc: .96; --op:.96"></span>
          <span class="petal" style="--rot: 56deg; --sc: .92; --op:.94"></span>
          <span class="petal" style="--rot: 84deg; --sc: .88; --op:.92"></span>
          <span class="petal" style="--rot: 112deg;--sc: .84; --op:.90"></span>
          <span class="core"></span>
        </div>

        <div class="tapBadge">Toca las rosas ðŸŒ¹</div>
      </button>

      <div class="bottomNote">Tip: si no actualiza, abre el link con <b>?v=2</b> para evitar cachÃ©.</div>
    </section>

    <!-- CARTA -->
    <div class="overlay" id="overlay" aria-hidden="true">
      <article class="card" role="dialog" aria-modal="true" aria-label="Carta para Ale">
        <button class="close" id="closeCard" aria-label="Cerrar carta">âœ•</button>

        <header class="cardHeader">
          <div class="stamp">ðŸ’Œ</div>
          <h1>Para Ale</h1>
          <p>14 de febrero</p>
        </header>

        <div class="cardBody">
          <p>
            Ale, hoy no querÃ­a dejar pasar el dÃ­a sin recordarte algo importante:
            <b>tu amistad vale muchÃ­simo</b>.
          </p>
          <p>
            Gracias por estar, por tu forma de hablar, por las risas que salen sin avisar
            y por esos momentos en los que simplemente con tu presencia todo se siente mejor.
          </p>
          <p>
            Admiro tu manera de seguir adelante, tu corazÃ³n y tu forma de ser. OjalÃ¡ la vida te trate bonito,
            te abrace cuando lo necesites y te regrese multiplicado todo lo bueno que das.
          </p>
          <p>
            Si algÃºn dÃ­a dudas, acuÃ©rdate de esto: hay personas que te quieren en su vida tal como eres.
            Y yo soy una de esas personas. ðŸ’›
          </p>

          <p class="signature">
            Con cariÃ±o,kokito<br />
            <span class="line">âœ¨</span>
          </p>
        </div>

        <footer class="cardFooter">
          <span class="mini">Toca fuera de la carta para cerrar ðŸŒ™</span>
        </footer>
      </article>
    </div>
  </main>

  <script>
    const intro = document.getElementById("intro");
    const flowersScreen = document.getElementById("flowersScreen");
    const heartBtn = document.getElementById("heartBtn");
    const bouquetBtn = document.getElementById("bouquetBtn");

    const overlay = document.getElementById("overlay");
    const closeCard = document.getElementById("closeCard");

    let built = false;

    // A prueba de Safari cache: iniciar overlay apagado siempre
    overlay.classList.remove("active");
    overlay.classList.remove("showCard");

    heartBtn.addEventListener("click", () => {
      intro.classList.add("fadeOut");

      setTimeout(() => {
        intro.hidden = true;
        flowersScreen.hidden = false;
        flowersScreen.classList.add("fadeIn");

        requestAnimationFrame(() => {
          flowersScreen.classList.add("build");
        });

        built = true;
      }, 350);
    });

    bouquetBtn.addEventListener("click", () => {
      if (!built) return;

      overlay.classList.add("active");
      requestAnimationFrame(() => {
        overlay.classList.add("showCard");
      });
    });

    function closeOverlay(){
      overlay.classList.remove("showCard");
      overlay.classList.remove("active");
    }

    closeCard.addEventListener("click", closeOverlay);

    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) closeOverlay();
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeOverlay();
    });
  </script>
</body>
</html>
